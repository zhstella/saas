<%# 
  !! è¿™æ˜¯ app/views/posts/show.html.erb çš„ã€æ›´æ–°ç‰ˆã€‘å†…å®¹ !!
%>

<div class="main-content-container">

  <%# --- 1. å¸–å­å†…å®¹ --- %>
  <h2 class="page-title"><%= @post.title %></h2>
  <div class="post-meta">
    <span class="post-author">
      Posted by: 
      <% if @post.user == current_user %>
        <strong>You</strong>
      <% else %>
        <%= @post.user.email %>
      <% end %>
    </span>
    <span class="post-time"><%= time_ago_in_words(@post.created_at) %> ago</span>
  </div>
  <div class="post-body">
    <%= @post.body %>
  </div>

<%# --- 2. å¸–å­æ“ä½œ --- %>
  <div class="post-actions">

    <div class="post-actions-left">
      <%= link_to "Like (ðŸ‘ 0)", "#", class: "form-cancel-button" %>
      <%= link_to "Comments (#{ @post.comments.count })", "#new-comment-section", 
                  id: "toggle-comment-form-btn", 
                  class: "form-cancel-button" %>
    </div>

    <% if @post.user == current_user %>
      <%= button_to "Delete This Post", @post, 
                  method: :delete, 
                  class: "btn-destructive",
                  data: { turbo_confirm: "Are you sure..." } %>
    <% end %>
  </div>
  
  <hr class="section-divider">

  <div id="new-comment-section">
    
    <%# --- 3. æ–°è¯„è®ºè¡¨å• (çŽ°åœ¨åœ¨ Wrapper å†…éƒ¨) --- %>
    <h3 class="comments-title">Add Your Comment</h3>
    
    <%= form_with(model: [@post, @comment]) do |form| %>
      <div class="form-field">
        <%= form.label :body, "Comment Content", class: "form-label" %>
        <%= form.text_area :body, class: "form-textarea", rows: 4, placeholder: "Type your comment here..." %>
      </div>
      <div class="form-actions">
        <%= form.submit "Submit Comment", class: "form-submit-button" %>
      </div>
    <% end %>

    <hr class="section-divider">
  </div>

  <%# --- 4. è¯„è®ºåˆ—è¡¨ --- %>
  <h3 class="comments-title">Comments (<%= @post.comments.count %>)</h3>

  <div class="comments-list-container">
    <% @post.comments.each do |comment| %>
      <div class="comment-card">

        <%# è¯„è®ºä½œè€…å’Œæ—¶é—´ %>
        <div class="comment-meta">
          <span class="comment-author">
            <% if comment.user == current_user %>
              <strong>You</strong>
            <% else %>
              <%= comment.user.email %>
            <% end %>
          </span>
          <span class="comment-time"><%= time_ago_in_words(comment.created_at) %> ago</span>
        </div>

        <%# è¯„è®ºæ­£æ–‡ %>
        <div class="comment-body">
          <%= comment.body %>
        </div>

        <%# åˆ é™¤è¯„è®ºçš„é“¾æŽ¥ %>
        <% if comment.user == current_user %>
          <div class="comment-actions">
            <%= button_to "Delete Comment", [@post, comment], 
                        method: :delete, 
                        class: "comment-delete-link",
                        data: { turbo_confirm: "Are you sure?" } %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

</div>